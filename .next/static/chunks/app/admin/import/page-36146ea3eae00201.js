(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{1149:(e,t,a)=>{Promise.resolve().then(a.bind(a,1527))},6046:(e,t,a)=>{"use strict";var r=a(6658);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},1527:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(5155),l=a(2115),s=a(6046),i=a(5037);function n(){let e=(0,s.useRouter)(),[t,a]=(0,l.useState)([]),[n,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(null),[m,g]=(0,l.useState)(""),p=async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t[0]))return;let r=e.target.files[0];console.log("Se\xe7ilen dosya:",r.name),d(null),g("");try{g("XML dosyası okunuyor...");let e=new FileReader;e.onerror=e=>{console.error("Dosya okuma hatası:",e),d("Dosya okunurken bir hata oluştu")},e.onload=async e=>{try{var t,r,l,s,i,n,o,c,m;console.log("Dosya başarıyla okundu");let d=null===(t=e.target)||void 0===t?void 0:t.result;g("XML ayrıştırılıyor...");let p=new DOMParser().parseFromString(d,"text/xml");if(p.getElementsByTagName("parsererror").length>0)throw Error("Ge\xe7ersiz XML formatı");let h=p.getElementsByTagName("item");console.log("Bulunan item sayısı:",h.length);let u=[],y=0;g("\xdcr\xfcnler işleniyor...");for(let e=0;e<h.length;e++){let t=h[e],a=null===(r=t.getElementsByTagName("wp:post_type")[0])||void 0===r?void 0:r.textContent,d=null===(l=t.getElementsByTagName("wp:status")[0])||void 0===l?void 0:l.textContent;if("appetit_item"===a&&"publish"===d){y++,g("".concat(y,"/").concat(h.length," \xfcr\xfcn işleniyor..."));let e=(null===(s=t.getElementsByTagName("title")[0])||void 0===s?void 0:s.textContent)||"";console.log("İşlenen \xfcr\xfcn (".concat(y,"/").concat(h.length,"):"),e);let a=t.getElementsByTagName("wp:postmeta"),r="";for(let e=0;e<a.length;e++){let t=null===(i=a[e].getElementsByTagName("wp:meta_key")[0])||void 0===i?void 0:i.textContent;if("appetit_item_meta"===t){r=(null===(n=a[e].getElementsByTagName("wp:meta_value")[0])||void 0===n?void 0:n.textContent)||"";break}}if(r)try{let e=r.replace(/^\[CDATA\[|\]\]$/g,""),a=e.match(/item_name_1";s:\d+:"([^"]+)/),l=e.match(/item_description_1";s:\d+:"([^"]+)/),s=e.match(/price";s:\d+:"(\d+\.\d+|\d+)"/),i=e.match(/product_variations";a:\d+:{([^]*)}}/m),n=[];if(i){let e;let t=i[1],a=/i:\d+;a:\d+:{([^}]*?)}/g;for(;null!==(e=a.exec(t));){let t=e[1],a=t.match(/price";s:\d+:"(\d+)"/),r=t.match(/variation_name_1";s:\d+:"([^"]+)"/),l=t.match(/ID";s:\d+:"([^"]+)"/);r&&a&&(n.push({id:(null==l?void 0:l[1])||Math.random().toString(36).substr(2,9),name:r[1],price:a[1]}),console.log("Varyasyon eklendi: ".concat(r[1]," - ").concat(a[1],"TL")))}console.log("Toplam bulunan varyasyonlar:",n.length,n)}if(a){let r=a[1],i=l?l[1]:"",d=n.length>0?n[0].price:s?s[1]:"0",g=t.getElementsByTagName("category"),p=[];for(let e=0;e<g.length;e++){let t=g[e].getAttribute("domain");if("appetit_items_category"===t){let t=g[e].textContent||"Genel";p.push(t)}}let y=p.length>0?p[0]:"Genel",x=e.match(/square_photo";s:\d+:"(\d+)"/),f=null;if(x){let e=x[1];for(let t=0;t<h.length;t++){let a=h[t];if((null===(o=a.getElementsByTagName("wp:post_type")[0])||void 0===o?void 0:o.textContent)==="attachment"&&(null===(c=a.getElementsByTagName("wp:post_id")[0])||void 0===c?void 0:c.textContent)===e){f=(null===(m=a.getElementsByTagName("wp:attachment_url")[0])||void 0===m?void 0:m.textContent)||null;break}}}let b=y.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-"),v=f?"/dishes/".concat(r.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-"),".jpg"):"/placeholder.jpg",N="/categories/".concat(b,".jpg"),w=[];p.length>1&&w.push({id:Math.random().toString(36).substr(2,9),icon:"\uD83C\uDFF7️",label:"Kategori",value:p.slice(1).join(", ")}),u.push({id:Math.random().toString(36).substr(2,9),name:r,description:i,price:d,category:y,image:v,categoryImage:N,imageUrl:f,features:w.length>0?w:[],variations:n.length>0?n:void 0}),console.log("\xdcr\xfcn eklendi: ".concat(r," (").concat(n.length," varyasyon, ").concat(p.length," kategori)"))}}catch(e){console.error("Meta parse hatası:",e)}}}console.log("Toplam bulunan \xfcr\xfcn sayısı:",u.length),g("".concat(u.length," \xfcr\xfcn bulundu")),a(u)}catch(e){console.error("XML işleme hatası:",e),d(e instanceof Error?e.message:"XML işlenirken bir hata oluştu")}},e.readAsText(r)}catch(e){console.error("Genel hata:",e),d("XML dosyası işlenirken bir hata oluştu")}},h=async()=>{if(t.length){o(!0),d(null),g("İ\xe7e aktarma başlatılıyor...");try{let a=[...new Set(t.map(e=>e.category))].map(e=>{var a;return{id:Math.random().toString(36).substr(2,9),name:e,image:(null===(a=t.find(t=>t.category===e))||void 0===a?void 0:a.categoryImage)||"",description:"".concat(e," kategorisindeki lezzetli \xfcr\xfcnlerimiz")}});for(let e of(g("Kategoriler kaydediliyor..."),a))if(!(await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Kategori eklenirken bir hata oluştu");let r=[];for(let e of t){if(g("".concat(e.name," i\xe7in resimler indiriliyor...")),e.imageUrl)try{await fetch("/api/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl,savePath:e.image})})}catch(t){console.error("Resim indirme hatası (".concat(e.name,"):"),t)}if(!r.some(t=>t.category===e.category)&&e.imageUrl)try{await fetch("/api/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl,savePath:e.categoryImage})})}catch(t){console.error("Kategori resmi indirme hatası (".concat(e.category,"):"),t)}let t={id:e.id,name:e.name,description:e.description,price:e.price,category:e.category,image:e.image,categoryImage:e.categoryImage,features:e.features,variations:e.variations};r.push(t)}for(let e of(g("\xdcr\xfcnler kaydediliyor..."),r))if(!(await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("\xdcr\xfcn eklenirken bir hata oluştu");i.oR.success("İ\xe7e aktarma başarıyla tamamlandı"),e.push("/admin/menu")}catch(e){d("İ\xe7e aktarma sırasında bir hata oluştu"),console.error("İ\xe7e aktarma hatası:",e),i.oR.error("İ\xe7e aktarma sırasında bir hata oluştu")}finally{o(!1),g("")}}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,r.jsx)("header",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"XML Import"}),(0,r.jsx)("button",{onClick:()=>e.back(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",children:"Geri"})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WordPress XML Dosyası"}),(0,r.jsx)("input",{type:"file",accept:".xml",onChange:p,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100"})]}),c&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:c})}),m&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-blue-600",children:m})}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900",children:["İ\xe7e Aktarılacak \xdcr\xfcnler (",t.length,")"]}),(0,r.jsx)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\xdcr\xfcn"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kategori"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fiyat"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Porsiyon Se\xe7enekleri"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((e,t)=>{var a;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.category}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.price," ₺"]}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:null===(a=e.variations)||void 0===a?void 0:a.map(e=>(0,r.jsxs)("div",{className:"whitespace-nowrap",children:[e.name,": ",e.price," ₺"]},e.id))})]},t)})})]})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:h,disabled:n,className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-md shadow-sm hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"İ\xe7e Aktarılıyor...":"İ\xe7e Aktar"})})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[37,441,517,358],()=>t(1149)),_N_E=e.O()}]);